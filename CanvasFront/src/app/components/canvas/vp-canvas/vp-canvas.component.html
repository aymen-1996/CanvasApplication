  <div class="element-bmc">
    <div class="header">

      <div class="navbar">
        <div class="css-1ir47a1">
          <a routerLink="/projects" class="no-underline">
            <h2 class="logo"><span style="color: rgb(33, 150, 243)">Canvas</span></h2>
          </a>    <div class="MuiBox-root css-i9gxme"></div>
          <div class="css-1x4nai">
            <mat-icon>menu</mat-icon>
            <mat-icon>info</mat-icon>
            <mat-form-field class="custom-select">
              <mat-label>Projet actuel</mat-label>
              <mat-select >
                <mat-option >
              Mes projets
                </mat-option>
                <mat-option *ngFor="let project of projects" [value]="project.idProjet"(click)="navigateToBmc(project)">
                  {{ project.nomProjet }}
                </mat-option>
                
                
                
              </mat-select>
            </mat-form-field>
      
      <div class="dropdown-container">
        <mat-icon class="maticons" (click)="togglePendingInvitesDropdown()">email</mat-icon>
      
        <div *ngIf="pendingInvitesCount > 0" class="badge">{{ pendingInvitesCount }}</div>
      
        <div class="dropdown-content" *ngIf="showPendingInvitesDropdown">
          <ng-container *ngIf="pendingInvites && pendingInvites.length > 0; else noInvites">
            <div *ngFor="let invite of pendingInvites" class="dropdown-item" (click)="openPopup1(invite.idInvite)">
              <p class="invite">Vous avez une Invitation dans <br><strong>{{ invite.canvas.nomCanvas}}</strong> de projet <strong>{{ invite.projet.nomProjet }}</strong></p>
            </div>
          </ng-container>
          <ng-template #noInvites>
            <div class="dropdown-item">
              <p class="no-invite">Aucune invitation en attente.</p>
            </div>
          </ng-template>
        
         
        </div>
      </div>
      
            <div class="dropdown-container">
              <mat-icon class="circular-image" (click)="toggleDropdown()">
                <img [src]="userPhotoUrl" alt="User Photo">
              </mat-icon>
            
              <div class="dropdown-content" *ngIf="showDropdown">
                <div (click)="logout()" class="dropdown-item">
                  <mat-icon>logout</mat-icon> <p class="mat">Deconnexion</p>
                </div>
                <div routerLink="/profil"  class="dropdown-item">
                  <mat-icon>settings</mat-icon> <p class="mat">Paramétre</p>
                </div>
              </div>
            </div>
            
            
            
                </div>
         
      
        </div>  
      
      </div>
          </div>
  <div class="items-bmc"*ngIf="blocks  && blocks?.length > 0">
    <div class="item-bmc">
      <div> <p class="css-tq1709" *ngIf="shouldDisplayMesg()">Enregistré <mat-icon>done</mat-icon></p></div>   
        <div><mat-stepper *ngIf="userRole?.roleInvite === 'editor'" class="demo-stepper" (selectionChange)="onStepChange($event)">
          <mat-step>            
            <p class="css-vgwlcw">Etape 1</p>
            <div class="css-igeghr">Jobs to be done</div>
          </mat-step>
          <mat-step>            
            <p class="css-vgwlcw">Etape 2.</p>
            <div class="css-igeghr">
              Pains
            </div>
          </mat-step>
          <mat-step>            
            <p class="css-vgwlcw">Etape 3</p>
            <div class="MuiBox-root css-igeghr">
              Gains
          </div>
          </mat-step>
          <mat-step>            
            <p class="css-vgwlcw">Etape 4</p>
            <div class="MuiBox-root css-igeghr">
              Produits & services
            </div>
          </mat-step>
           <mat-step>            
            <p class="css-vgwlcw">Etape 5</p>
            <div class="MuiBox-root css-igeghr">
              Pain Relievers
            </div>
          </mat-step>
           <mat-step>            
            <p class="css-vgwlcw">Etape 6</p>
            <div class="MuiBox-root css-igeghr">
              Pain Relievers
            </div>
          </mat-step>
          <mat-step >            
            <p class="css-vgwlcw">Etape 7</p>
            <div class="MuiBox-root css-igeghr">Sommaire</div>
          </mat-step>
          
     
        </mat-stepper>
      </div>
       <div class="css-1tfsht7"> 
          <div class="css-9bzmof" *ngIf="!showTable && userRole?.roleInvite === 'editor'">
            <div class="container" style="margin-right: auto; margin-left: auto; padding-right: 15px; padding-left: 15px; max-height: 350px; overflow-y: auto;">
              <div class="notes-list" style="width: 112%; display: grid; grid-template-columns: 1fr 1fr 1fr;">
                <form [formGroup]="donneesForm" *ngIf="showAddButton && donnees?.length < 3">

                <div  class="MuiBox-root css-4xg6x2" title="Ajouter un post-it"  (click)="creatColor()">
                  <mat-icon>add</mat-icon>
                </div>
                </form>
                <div [style.backgroundColor]="donnees?.coleur " class="note MuiBox-root css-t4333k" (click)="toggleDeleteButton(donnees)" *ngFor="let donnees of donnees">
                  <div >
                    <div *ngIf="showDeleteButton && isSelectedDonnee(donnees)" class="note-action MuiBox-root css-cpm1aj">
                      <button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeMedium css-1m32rbj" tabindex="0" type="button">
                        <svg  style=" position: absolute;top: 0; left: 0;" (click)="toggleFormVisibility(donnees.idDonnees)" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img"
                          class="MuiBox-root css-3o0h5k iconify iconify--akar-icons" sx="[object Object]" width="1em" height="1em"
                          preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24">
                          <g fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="4" cy="12" r="1"></circle>
                            <circle cx="12" cy="12" r="1"></circle>
                            <circle cx="20" cy="12" r="1"></circle>
                          </g>
                        </svg>
                        
                        <form (click)="toggleFormVisibility(donnees.idDonnees)"*ngIf="isFormVisibleForItemId(donnees.idDonnees)" class="color-form">

                        <ng-container  *ngFor="let group of groupColors(generatedColors)">
                          <div  class="color-group">
                            <div class="circle" *ngFor="let color of group" [style.background-color]="color"  (click)="updateColor(donnees.idDonnees, color)"></div>
                          </div>
                        </ng-container>
                        <svg (click)="openPopup(donnees.idDonnees)" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">
                          <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5M11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5"/>
                        </svg> 
                        <span class="MuiTouchRipple-root css-w0pj6f"></span>
                      </form>

                      </button>
                    </div>
                    <form [formGroup]="donneesForms" >
                      <textarea
                      (keydown.enter)="onEnterKey($event)"
                      (input)="updateTicketValue($event)"
                      (keyup.enter)="updatedonne(donnees.idDonnees)"
                      (blur)="updatedonne(donnees.idDonnees)"

                      maxlength="150"
                      style="color: inherit; background: transparent; border: none; outline: none; height: 100%; width: 100%; resize: none; font-family: inherit; font-size: inherit; font-weight: inherit; font-style: inherit; word-break: break-word;"
                    >{{ donnees.ticket}}</textarea>
                    
                    </form>
                    
                  </div>
                  
                </div>
              </div>
         
            </div>

          
          </div>
         
          <div class="button-container">
            <button class="download-button" *ngIf="showTable ||userRole?.roleInvite === 'moniteur' " mat-raised-button color="primary" (click)="telechargerPDF()">Télécharger en PDF</button>
            <button *ngIf="showTable && userRole?.roleInvite === 'editor'" class="download-button" mat-raised-button color="primary" (click)="openPopupInvite()">Envoyer Invitation</button>
          </div>
          
          <div id="tableau" class="MuiGrid-root MuiGrid-grid-md-7 wi" [ngClass]="{'center-container': showTable ||userRole?.roleInvite === 'moniteur' }">
            
            
            <div  class="MuiBox-root css-q12xye">
             
              <div class="MuiBox-root css-dj29ny">
                <div class="MuiBox-root css-1f7kqzk">
                </div>
                <div class="MuiBox-root css-1h4xcdt" >
                  <div class="MuiBox-root css-1mos2a"
                  (click)="detectedBlockById(blocks[3].idBlock)"
   [ngClass]="{ 'selected': isSelected(blocks[3].idBlock) }"
   [ngStyle]="{ 'background-color': isSelected(blocks[3].idBlock) ? 'rgb(247, 222, 58)' : '' }"
   (click)="toggleSelection(blocks[3].idBlock)">
</div>
                </div>
                <div class="MuiBox-root css-1im73hr">
                  <div class="MuiBox-root css-106p5i6"  (click)="detectedBlockById(blocks[5].idBlock)"
                  [ngClass]="{ 'selected': isSelected(blocks[5].idBlock) }"
                  [ngStyle]="{ 'background-color': isSelected(blocks[5].idBlock) ? 'rgb(247, 222, 58)' : '' }"
                  (click)="toggleSelection(blocks[5].idBlock)">
                  </div>
                </div>
                <div class="MuiBox-root css-ovo830">
                  <div class="MuiBox-root css-1ibwdff"(click)="detectedBlockById(blocks[4].idBlock)"
                  (click)="toggleSelection(blocks[4].idBlock)"
                  [ngClass]="{ 'selected': isSelected(blocks[4].idBlock) }"
                  [ngStyle]="{ 'background-color': isSelected(blocks[4].idBlock) ? 'rgb(247, 222, 58)' : '' }">
              </div>
              
            
            
                  <div class="MuiBox-root css-vs70bc"><div class="MuiBox-root css-nj7m7v"></div><div class="MuiBox-root css-vyjs61"></div><div class="MuiBox-root css-gti070"><div class="MuiBox-root css-8ak2xo"></div></div></div>
                </div><div class="MuiBox-root css-jh7kf8">
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="MuiBox-root css-uwwqev iconify iconify--teenyicons" sx="[object Object]" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 15 15"><path fill="none" stroke="currentColor" d="M13.5 7.5h-12m12 0a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1h-12a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1m12 0v5a2 2 0 0 1-2 2h-8a2 2 0 0 1-2-2v-5m6-3v-1m0 1H4.214A1.714 1.714 0 0 1 2.5 2.786V2.5a2 2 0 0 1 2-2a3 3 0 0 1 3 3m0 1h3.286c.947 0 1.714-.768 1.714-1.714V2.5a2 2 0 0 0-2-2a3 3 0 0 0-3 3m0 1v10"></path></svg></div>
                  <div class="MuiBox-root css-0" style="position: absolute; top: calc(50% - 5px); left: calc(100% - 1px); width: 50px; height: 10px; background: black; clip-path: polygon(0px 3px, calc(100% - 5px) 3px, calc(100% - 5px) 0px, 100% 50%, calc(100% - 5px) 100%, calc(100% - 5px) calc(100% - 3px), 0px calc(100% - 3px));">
                  </div></div><div class="MuiBox-root css-1cfjgrp">
                    <div class="MuiBox-root css-vs70bc">
                      <div (click)="detectedBlockById(blocks[2].idBlock)" class="MuiBox-root css-nj7m7v"  [ngClass]="{ 'selected': isSelected(blocks[2].idBlock) }"
                      [ngStyle]="{ 'background-color': isSelected(blocks[2].idBlock) ? 'rgb(247, 222, 58)' : '' }"
                      (click)="toggleSelection(blocks[2].idBlock)">

                      </div>
                      <div class="MuiBox-root css-o7p13d"  (click)="detectedBlockById(blocks[1].idBlock)"  [ngClass]="{ 'selected': isSelected(blocks[1].idBlock) }"
                      [ngStyle]="{ 'background-color': isSelected(blocks[1].idBlock) ? 'rgb(247, 222, 58)' : '' }"
                      (click)="toggleSelection(blocks[1].idBlock)">

                      </div>
                      <div class="MuiBox-root css-gti070">
                        <div (click)="detectedBlockById(blocks[0].idBlock)" class="MuiBox-root css-8ak2xo" [ngClass]="{ 'selected': isSelected(blocks[0].idBlock) }"
                        [ngStyle]="{ 'background-color': isSelected(blocks[0].idBlock) &&userRole?.roleInvite !== 'moniteur' ? 'rgb(247, 222, 58)' : '' }"
                        (click)="toggleSelection(blocks[0].idBlock)">
                      </div>
                    </div>
                  </div>
                  <div class="MuiBox-root css-jh7kf8">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="MuiBox-root css-uwwqev iconify iconify--iconoir" sx="[object Object]" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path fill="currentColor" d="M8.5 9a.5.5 0 1 1 0-1a.5.5 0 0 1 0 1"></path><path d="M2.458 15A9.996 9.996 0 0 1 2 12C2 6.477 6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10c-4.478 0-8.268-2.943-9.542-7m0 0H7"></path></g></svg>
                  </div>
                  <div class="MuiBox-root css-0" style="position: absolute; top: calc(50% - 5px); right: calc(50% + 20px); transform: rotate(180deg); width: 190px; height: 10px; background: black; clip-path: polygon(0px 3px, calc(100% - 5px) 3px, calc(100% - 5px) 0px, 100% 50%, calc(100% - 5px) 100%, calc(100% - 5px) calc(100% - 3px), 0px calc(100% - 3px));">
                 
                  </div>

                  <div *ngFor="let donnee of blocks[0]?.donnees; let i = index">
                    <div [style.backgroundColor]="donnee?.coleur" [style.top]="positions[i].top" [style.left]="positions[i].left" class="MuiBox-root css-1kpke41">
                      <p class="title1">{{donnee?.ticket}}</p>
                    </div>
                  </div>
                  
                  
                  <div *ngFor="let donnee of blocks[1].donnees; let i = index">
                    <div [style.backgroundColor]="donnee?.coleur" class="MuiBox-root css-tvdvmv"
                         [ngStyle]="calculatePosition(i)">
                      <p class="title1">{{donnee?.ticket}}</p>
                    </div>
                  </div>
                  
                
                  <div *ngFor="let donnee of blocks[2].donnees; let i = index">
                    <div [style.backgroundColor]="donnee?.coleur" class="MuiBox-root css-kd41sq"
                         [ngStyle]="calculatePositionBlock2(i)">
                      <p class="title1">{{donnee?.ticket}}</p>
                    </div>
                  </div>

                  <div *ngFor="let donnee of blocks[4].donnees; let i = index">
                    <div [style.backgroundColor]="donnee?.coleur" class="MuiBox-root css-hpubl3"
                         [ngStyle]="calculatePositionBlock4(i)">
                      <p class="title1">{{donnee?.ticket}}</p>
                    </div>
                  </div>

                  <div *ngFor="let donnee of blocks[5].donnees; let i = index">
                    <div [style.backgroundColor]="donnee?.coleur" class="MuiBox-root css-b2x6pc"
                         [ngStyle]="calculatePositionBlock5(i)">
                      <p class="title1">{{donnee?.ticket}}</p>
                    </div>
                  </div>
                  
                  
                  <div *ngFor="let donnee of blocks[3].donnees; let i = index">
                    <div [style.backgroundColor]="donnee?.coleur"  class="MuiBox-root css-v04ws1"
                    [ngStyle]="calculatePositionBlock3(i)">
                      <p class="title1">{{donnee?.ticket}}</p>
                    </div>
                  </div>
                  
               

             
                </div>
              </div>
            </div>
    </div> 
      
    </div>
  
  </div>
  <div class="css-1xto6kq">
    <button class="css-5357ut" 
    tabindex="0" 
    type="button" 
    (click)="precedent()" 
    [disabled]="userRole?.roleInvite === 'moniteur' || currentBlockIndex === 0">
Précédent
<span class="css-w0pj6f"></span>
</button>
        <div class="css-11qjisw">
        </div> 
        <button *ngIf="shouldDisplayButton()"class="css-ivnzlx"  tabindex="0" type="button" (click)="suivant()">
          {{ currentBlockIndex === 5 ? 'Terminer' : 'Suivant' }}
          <span class="css-w0pj6f"></span>

        </button>
     
</div>

</div>
